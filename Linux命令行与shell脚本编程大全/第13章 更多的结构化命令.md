# 第13章 更多的结构化命令

```
bash shell的循环命令for、while、until
```

---

## `for`命令

```
for var in list
do
	commands
done
list参数需要提供迭代中要用到的一系列值。在do和done语句之间输入的命令可以是一条或多条标准的bash shell命令。
```
- 读取列表中的值
	```
	$ cat test1
    #!/bin/bash
    # basic for command
    for test in Alabama Alaska Arizona Arkansas California Colorado
    do
    echo The next state is $test
    done
  $ ./test1
    The next state is Alabama
    The next state is Alaska
    The next state is Arizona
    The next state is Arkansas
    The next state is California
    The next state is Colorado
  $
  $test会一直保持最后一次迭代的值，除非你修改了它
  ```

- 读取列表中的复杂值
	```
	  $ cat test2
    #!/bin/bash
    # another example of how not to use the for command
    for test in I don\'t know if "this'll" work
    do
    echo "word:$test"
    done
    $ ./test2
    word:I
    word:don't
    word:know
    word:if
    word:this'll
    word:work
    $
    
    反斜线将单引号转义，或双引号定义用到单引号的值
  ```
    for循环假定每个值都是用空格分割的
    ```
    $ cat test3
    #!/bin/bash
    # an example of how to properly define values
    for test in Nevada "New Hampshire" "New Mexico" "New York"
    do
    echo "Now going to $test"
    done
    $ ./test3
    Now going to Nevada
    Now going to New Hampshire
    Now going to New Mexico
    Now going to New York
    $
    for命令用空格来划分列表中的每个值。如果在单独的数据值中有空格，就必须用双引号将这些值圈起来。
    另外要注意的是，在某个值两边使用双引号时，shell并不会将双引号当成值的一部分。
    ```

- 从变量读取列表
	```
    $ cat test4
    #!/bin/bash
    # using a variable to hold the list
    list="Alabama Alaska Arizona Arkansas Colorado"
    list=$list" Connecticut"
	  for state in $list
    do
    	echo "Have you ever visited $state?"
    done
    $ ./test4
    Have you ever visited Alabama?
    Have you ever visited Alaska?
    Have you ever visited Arizona?
    Have you ever visited Arkansas?
    Have you ever visited Colorado?
    Have you ever visited Connecticut?
    $
    
    拼接，向变量中存储的已有文本字符串尾部添加文本的一个常用方法。
	```
	
- 从命令读取值
	```
	  $ cat test5
    #!/bin/bash
    将文件名赋给变量，文件名中没有加入路径。这要求文件和脚本位于同一个目录中。
    # reading values from a file
    file="states"
    for state in $(cat $file)
    do
    echo "Visit beautiful $state"
    done
    $ cat states
    Alabama
    Alaska
    Arizona
    Arkansas
    Colorado
    Connecticut
    Delaware
    Florida
    $ ./test5
    Visit beautiful Alabama
    Visit beautiful Alaska
    Visit beautiful Arizona
    Visit beautiful Arkansas
    Visit beautiful Colorado
    Visit beautiful Connecticut
    Visit beautiful Delaware
    Visit beautiful Florida
    for命令以每次一行的方式遍历了cat命令的输出。
    如果列出了一个名字中有空格的州，for命令会将每个单词当作单独的值。即New和York分开
    
  ```

- 更改字段分隔符
	特殊的环境变量，内部字段分隔符IFS，定义了bash shell用作字段分隔符的一系列字符，默认为：空格、制表符、换行符。如果bash shell在数据中看到了这些字符中的任意一个，它就会假定这表明了列表中一个新数据字段的开始。这给我们带来了麻烦。
	- `IFS=$'\n'`
	  
	  ```
      $ cat test5b
        #!/bin/bash
        # reading values from a file
        file="states"
        IFS=$'\n'
        for state in $(cat $file)
        do
        echo "Visit beautiful $state"
        done
      $ ./test5b
        Visit beautiful Alabama
        Visit beautiful Alaska
        Visit beautiful Arizona
        Visit beautiful Arkansas
        Visit beautiful Colorado
        Visit beautiful Connecticut
        Visit beautiful Delaware
        Visit beautiful Florida
        Visit beautiful Georgia
        Visit beautiful New York
        Visit beautiful New Hampshire
        Visit beautiful North Carolina
	  $
	    可以在shell脚本中临时更改IFS环境变量的值来限制被bash shell当作字段分隔符的字符。
	  ```
	  ```
	  	IFS.OLD=$IFS
        IFS=$'\n'
        <在代码中使用新的IFS值>
        IFS=$IFS.OLD
        
        处理代码量大的脚本时可能只是在一个地方需要修改IFS的值，然后忽略这次修改。
    ```
    - IFS的其他绝妙用法
    	- `IFS=:`
    		```
    		假设要遍历一个文件中用冒号分割的值，比如/etc/passwd
    		```
    	- `IFS=$'\n':;"`
    		
    		```
    		指定多个IFS字符只需将它们在赋值行串起来，行符、冒号、分号和双引号。
    		```
  
- 用通配符读取目录
	```
	$ cat test6
    #!/bin/bash
    # iterate through all the files in a directory
    for file in /home/rich/test/*
    do
    if [ -d "$file" ]
    then
    	echo "$file is a directory"
    elif [ -f "$file" ]
    then
    	echo "$file is a file"
    fi
    done
    $ ./test6
    /home/rich/test/dir1 is a directory
    /home/rich/test/myprog.c is a file
    /home/rich/test/myprog is a file
    /home/rich/test/myscript is a file
    /home/rich/test/newdir is a directory
    /home/rich/test/newfile is a file
    /home/rich/test/newfile2 is a file
    /home/rich/test/testdir is a directory
    /home/rich/test/testing is a file
    /home/rich/test/testprog is a file
    /home/rich/test/testprog.c is a file
    $
    文件拓展匹配，for命令自动遍历目录中的文件
	```

- C语言风格的`for`命令
	```
	$ cat test8
    #!/bin/bash
    # testing the C-style for loop
    for (( i=1; i <= 10; i++ ))
    do
    	echo "The next number is $i"
    done
    $ ./test8
    The next number is 1
    The next number is 2
    The next number is 3
    The next number is 4
    The next number is 5
    The next number is 6
    The next number is 7
    The next number is 8
    The next number is 9
    The next number is 10
    $
  ```
    使用多个变量
    ```
    for (( a=1, b=10; a <= 10; a++, b-- ))
    do
    	echo "$a - $b"
    done
    ```
  
---

## `while`命令

